#!/bin/sh
# vim: set softtabstop=2 shiftwidth=2 expandtab :
# (c) 2022 KissCool

# use the various sub-scripts to produce a complete CVE report

# robustify the script
topdir=`dirname "$(realpath $0)"`

# filenames to use
horo=`date +'%y%m%d_%H%M'`
step1="${topdir}"/reports/cve_${horo}_step1.tsv
step2="${topdir}"/reports/cve_${horo}_step2.tsv
step3="${topdir}"/reports/cve_${horo}_step3.tsv
step4="${topdir}"/reports/cve_${horo}_step4.tsv

# generate the raw report
"${topdir}"/cpe2cve.sh $1 > $step1
# add CVSS base string
"${topdir}"/cve2cvss.sh $step1 > $step2
# then add CVE descriptions
"${topdir}"/cve2description.sh $step2 > $step3
# then do a first round of calculations (needed because some old NVD CVSS base scores are not coherent with their associated Base_vector)
"${topdir}"/cve_calculate.sh $step3 > $step4

