#!/bin/sh
# vim: set softtabstop=2 shiftwidth=2 expandtab :
# (c) 2019 KissCool

# Usage : cve2description.sh cve_without_description.txt

format="%-30s\t%-75s\t%-20s\t%s\t%s\t%s\n"

awk '
  BEGIN {
    # input and output use tabulations, and define a file header
    FS = OFS = "\t";
    printf "'$format'", "Pkg", "CPE", "CVE", "CVSS", "Assesment", "Description";
  }

  # skip the files headers
  FNR <= 1 { next }

  {
    # check if a description already exist
    description=$6
    if (! description) {
      cmd="./cve_description.sh "$3;
      ( cmd | getline description );
    } 
    # initialize the assesment if needed
    if (! $5) { 
      $5=0;
    }
    printf "'$format'", $1, $2, $3, $4, $5, description;
  }
' $1 

